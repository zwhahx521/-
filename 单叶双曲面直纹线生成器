<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•å¶åŒæ›²é¢ç›´çº¹çº¿ç”Ÿæˆå™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #0c0c1a 0%, #15152b 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #00b4d8;
        }
        
        h1 {
            color: #00b4d8;
            margin-bottom: 10px;
            font-size: 2.2em;
            text-shadow: 0 2px 10px rgba(0, 180, 216, 0.3);
        }
        
        .subtitle {
            color: #90e0ef;
            font-size: 1.1em;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
        }
        
        .canvas-container {
            flex: 1;
            min-width: 600px;
            height: 600px;
            background: #0a0a1a;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            position: relative;
            border: 1px solid rgba(0, 180, 216, 0.2);
        }
        
        #webgl-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .controls-panel {
            flex: 0 0 350px;
            background: rgba(20, 25, 40, 0.95);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 180, 216, 0.3);
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group h3 {
            color: #00b4d8;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(0, 180, 216, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        label {
            flex: 0 0 140px;
            font-size: 0.95em;
        }
        
        input[type="range"] {
            flex: 1;
            height: 6px;
            background: #2c3e50;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #00b4d8;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            background: #0096c7;
            transform: scale(1.1);
        }
        
        .value-display {
            width: 60px;
            text-align: center;
            font-family: 'Courier New', monospace;
            background: rgba(0,0,0,0.3);
            padding: 4px 8px;
            border-radius: 4px;
            margin-left: 10px;
            border: 1px solid #444;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .checkbox-group:hover {
            background: rgba(0, 180, 216, 0.1);
        }
        
        button {
            background: linear-gradient(to right, #00b4d8, #0077b6);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            transition: all 0.2s;
            margin: 5px;
            flex: 1;
            min-width: 120px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 180, 216, 0.3);
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            margin-top: 15px;
            gap: 8px;
        }
        
        .info-panel {
            background: rgba(25, 30, 50, 0.9);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #ff6b6b;
        }
        
        .info-panel h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
        }
        
        .equation {
            font-family: 'Cambria', 'Times New Roman', serif;
            font-size: 1.2em;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            border: 1px solid #444;
            color: #4cc9f0;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #2a2a4a;
            color: #90a0b0;
            font-size: 0.9em;
        }
        
        .transparency-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .transparency-control label {
            flex: 0 0 140px;
        }
        
        .transparency-control input {
            flex: 1;
        }
        
        @media (max-width: 1000px) {
            .main-content {
                flex-direction: column;
            }
            .canvas-container, .controls-panel {
                min-width: 100%;
            }
            .canvas-container {
                height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§¬ å•å¶åŒæ›²é¢ç›´çº¹çº¿ç”Ÿæˆå™¨</h1>
            <p class="subtitle">é€æ˜è¡¨é¢æ˜¾ç¤ºæ¨¡å¼ - æ¸…æ™°è§‚å¯Ÿç›´çº¹çº¿ä¸æ›²é¢çš„å…³ç³»</p>
        </header>
        
        <div class="main-content">
            <div class="canvas-container">
                <canvas id="webgl-canvas"></canvas>
            </div>
            
            <div class="controls-panel">
                <div class="control-group">
                    <h3>ğŸ“ åŒæ›²é¢å‚æ•°</h3>
                    <div class="control-row">
                        <label for="a-param">a (xè½´):</label>
                        <input type="range" id="a-param" min="0.5" max="5" step="0.1" value="2">
                        <span class="value-display" id="a-value">2.0</span>
                    </div>
                    <div class="control-row">
                        <label for="b-param">b (yè½´):</label>
                        <input type="range" id="b-param" min="0.5" max="5" step="0.1" value="1.8">
                        <span class="value-display" id="b-value">1.8</span>
                    </div>
                    <div class="control-row">
                        <label for="c-param">c (zè½´):</label>
                        <input type="range" id="c-param" min="0.5" max="5" step="0.1" value="1.2">
                        <span class="value-display" id="c-value">1.2</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ§µ ç›´çº¹çº¿æ§åˆ¶</h3>
                    <div class="control-row">
                        <label for="line-count">æ¯ç»„çº¿æ•°:</label>
                        <input type="range" id="line-count" min="10" max="80" step="2" value="40">
                        <span class="value-display" id="line-count-value">40</span>
                    </div>
                    <div class="control-row">
                        <label for="line-length">çº¿é•¿åº¦:</label>
                        <input type="range" id="line-length" min="2" max="15" step="0.5" value="8">
                        <span class="value-display" id="line-length-value">8.0</span>
                    </div>
                    <div class="control-row">
                        <label for="line-width">çº¿å®½åº¦:</label>
                        <input type="range" id="line-width" min="1" max="5" step="0.5" value="2.5">
                        <span class="value-display" id="line-width-value">2.5</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ‘ï¸ æ˜¾ç¤ºæ§åˆ¶</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="show-family1" checked>
                        <label for="show-family1" style="color: #ff6b6b;">æ˜¾ç¤ºç¬¬ä¸€æ—ç›´çº¹çº¿ (çº¢è‰²)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="show-family2" checked>
                        <label for="show-family2" style="color: #4cc9f0;">æ˜¾ç¤ºç¬¬äºŒæ—ç›´çº¹çº¿ (è“è‰²)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="show-surface" checked>
                        <label for="show-surface">æ˜¾ç¤ºåŒæ›²é¢è¡¨é¢</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="show-wireframe">
                        <label for="show-wireframe">æ˜¾ç¤ºè¡¨é¢çº¿æ¡†</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="show-axes" checked>
                        <label for="show-axes">æ˜¾ç¤ºåæ ‡è½´</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="auto-rotate" checked>
                        <label for="auto-rotate">è‡ªåŠ¨æ—‹è½¬</label>
                    </div>
                    
                    <div class="transparency-control">
                        <label for="surface-opacity">è¡¨é¢é€æ˜åº¦:</label>
                        <input type="range" id="surface-opacity" min="0.1" max="0.8" step="0.05" value="0.3">
                        <span class="value-display" id="surface-opacity-value">0.3</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>âš™ï¸ é¢„è®¾æ¨¡å¼</h3>
                    <div class="button-group">
                        <button id="dense-btn">å¯†é›†ç¼–ç»‡</button>
                        <button id="sparse-btn">ç¨€ç–ç¼–ç»‡</button>
                        <button id="symmetric-btn">å¯¹ç§°å½¢å¼</button>
                        <button id="reset-btn">é‡ç½®å‚æ•°</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>ğŸ“š å•å¶åŒæ›²é¢ç›´çº¹çº¿æ•°å­¦åŸç†</h3>
            <p>å•å¶åŒæ›²é¢æ–¹ç¨‹ï¼š</p>
            <div class="equation">
                xÂ²/aÂ² + yÂ²/bÂ² - zÂ²/cÂ² = 1
            </div>
            <p>â€¢ <strong>åŒé‡ç›´çº¹é¢</strong>ï¼šåŒ…å«ä¸¤æ—ä¸åŒçš„ç›´æ¯çº¿ï¼Œæ¯æ—éƒ½å®Œå…¨è¦†ç›–æ›²é¢</p>
            <p>â€¢ <strong>ç¬¬ä¸€æ—æ–¹ç¨‹</strong>ï¼šx = a(cosÎ¸ + Î» sinÎ¸), y = b(sinÎ¸ - Î» cosÎ¸), z = cÎ»</p>
            <p>â€¢ <strong>ç¬¬äºŒæ—æ–¹ç¨‹</strong>ï¼šx = a(cosÎ¸ - Î¼ sinÎ¸), y = b(sinÎ¸ + Î¼ cosÎ¸), z = cÎ¼</p>
            <p>â€¢ <strong>æ•™å­¦è¦ç‚¹</strong>ï¼šé€æ˜è¡¨é¢å¯æ¸…æ™°å±•ç¤ºç›´çº¹çº¿å¦‚ä½•ç²¾ç¡®åœ°ä½äºæ›²é¢ä¹‹ä¸Š</p>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ff6b6b;"></div>
                    <span>ç¬¬ä¸€æ—ç›´çº¹çº¿</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #4cc9f0;"></div>
                    <span>ç¬¬äºŒæ—ç›´çº¹çº¿</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(255, 255, 255, 0.3);"></div>
                    <span>é€æ˜åŒæ›²é¢è¡¨é¢</span>
                </div>
            </div>
        </div>
        
        <footer>
            <p>å¤§å­¦è§£æå‡ ä½•äº¤äº’å¼æ•™å­¦å·¥å…· | å±•ç¤ºå•å¶åŒæ›²é¢çš„åŒé‡ç›´çº¹é¢æ€§è´¨</p>
            <p>æç¤ºï¼šé¼ æ ‡æ‹–æ‹½æ—‹è½¬è§†å›¾ï¼Œæ»šè½®ç¼©æ”¾ï¼Œå³é”®æ‹–æ‹½å¹³ç§» | å¯è°ƒèŠ‚è¡¨é¢é€æ˜åº¦</p>
        </footer>
    </div>

    <script>
        // åˆå§‹åŒ–Three.jsåœºæ™¯
        let scene, camera, renderer, controls;
        let hyperboloidGroup, surfaceMesh, surfaceWireframe, family1Group, family2Group, axesHelper;
        let animationId;
        
        // å‚æ•°çŠ¶æ€
        let params = {
            a: 2.0,
            b: 1.8,
            c: 1.2,
            lineCount: 40,      // æ¯ç»„ç›´çº¹çº¿çš„æ•°é‡
            lineLength: 8.0,    // ç›´çº¹çº¿é•¿åº¦
            lineWidth: 2.5,     // çº¿å®½åº¦
            surfaceOpacity: 0.3, // è¡¨é¢é€æ˜åº¦
            showFamily1: true,
            showFamily2: true,
            showSurface: true,
            showWireframe: false,
            showAxes: true,
            autoRotate: true,
            rotationAngle: 0
        };
        
        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            // åˆ›å»ºåœºæ™¯
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a1a);
            
            // åˆ›å»ºç›¸æœº
            const canvas = document.getElementById('webgl-canvas');
            const width = canvas.parentElement.clientWidth;
            const height = canvas.parentElement.clientHeight;
            
            camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
            camera.position.set(15, 15, 15); // è°ƒæ•´ç›¸æœºä½ç½®ç¡®ä¿èƒ½çœ‹åˆ°ç‰©ä½“
            camera.lookAt(0, 0, 0);
            
            // åˆ›å»ºæ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ 
                canvas: canvas,
                antialias: true,
                alpha: true
            });
            renderer.setSize(width, height);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            // æ·»åŠ è½¨é“æ§åˆ¶å™¨
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // æ·»åŠ å…‰æº - å¢å¼ºå…‰ç…§ä»¥ç¡®ä¿é€æ˜è¡¨é¢å¯è§
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.8); // å¢åŠ ç¯å¢ƒå…‰å¼ºåº¦
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0); // å¢åŠ ç›´å°„å…‰å¼ºåº¦
            directionalLight.position.set(10, 20, 15);
            scene.add(directionalLight);
            
            // åˆ›å»ºåæ ‡è½´
            axesHelper = new THREE.AxesHelper(8);
            axesHelper.visible = params.showAxes;
            scene.add(axesHelper);
            
            // åˆ›å»ºä¸»ç»„ï¼ŒåŒ…å«æ‰€æœ‰åŒæ›²é¢ç›¸å…³å¯¹è±¡
            hyperboloidGroup = new THREE.Group();
            scene.add(hyperboloidGroup);
            
            // åˆ›å»ºç›´çº¹çº¿ç»„
            family1Group = new THREE.Group();
            family2Group = new THREE.Group();
            hyperboloidGroup.add(family1Group);
            hyperboloidGroup.add(family2Group);
            
            // åˆ›å»ºåŒæ›²é¢è¡¨é¢å’Œçº¿æ¡†
            createHyperboloidSurface();
            
            // åˆ›å»ºä¸¤æ—ç›´çº¹çº¿
            createRuledLines();
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
            
            // å¼€å§‹åŠ¨ç”»å¾ªç¯
            animate();
            
            // çª—å£å¤§å°è°ƒæ•´ç›‘å¬
            window.addEventListener('resize', onWindowResize);
            
            // æ·»åŠ è°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°
            console.log("å•å¶åŒæ›²é¢ç”Ÿæˆå™¨å·²åˆå§‹åŒ–");
            console.log("å‚æ•°:", params);
        }
        
        // åˆ›å»ºå•å¶åŒæ›²é¢è¡¨é¢å’Œçº¿æ¡†
        function createHyperboloidSurface() {
            // ç§»é™¤æ—§çš„è¡¨é¢å’Œçº¿æ¡†
            if (surfaceMesh) {
                hyperboloidGroup.remove(surfaceMesh);
                if (surfaceMesh.geometry) surfaceMesh.geometry.dispose();
                if (surfaceMesh.material) surfaceMesh.material.dispose();
            }
            if (surfaceWireframe) {
                hyperboloidGroup.remove(surfaceWireframe);
                if (surfaceWireframe.geometry) surfaceWireframe.geometry.dispose();
                if (surfaceWireframe.material) surfaceWireframe.material.dispose();
            }
            
            // åˆ›å»ºåŒæ›²é¢å‡ ä½•ä½“
            const geometry = new THREE.ParametricGeometry(
                (u, v, target) => {
                    // å•å¶åŒæ›²é¢å‚æ•°æ–¹ç¨‹
                    // u âˆˆ [0, 1] -> Î¸ âˆˆ [0, 2Ï€]
                    // v âˆˆ [0, 1] -> z âˆˆ [-6, 6]
                    const theta = u * Math.PI * 2;
                    const z = (v - 0.5) * 12;
                    
                    // è®¡ç®—åŠå¾„
                    const r = Math.sqrt(1 + (z * z) / (params.c * params.c));
                    const x = params.a * r * Math.cos(theta);
                    const y = params.b * r * Math.sin(theta);
                    
                    target.set(x, y, z);
                },
                50,  // uåˆ†æ®µæ•°
                50   // våˆ†æ®µæ•°
            );
            
            // ç¡®ä¿å‡ ä½•ä½“å·²æ­£ç¡®è®¡ç®—
            geometry.computeVertexNormals();
            
            // åˆ›å»ºé€æ˜è¡¨é¢æè´¨
            const surfaceMaterial = new THREE.MeshPhongMaterial({
                color: 0xffffff,
                transparent: true,
                opacity: params.surfaceOpacity,
                side: THREE.DoubleSide,
                wireframe: false,
                shininess: 50,
                specular: 0x333333
            });
            
            // åˆ›å»ºè¡¨é¢ç½‘æ ¼
            surfaceMesh = new THREE.Mesh(geometry, surfaceMaterial);
            surfaceMesh.visible = params.showSurface;
            hyperboloidGroup.add(surfaceMesh);
            
            // åˆ›å»ºçº¿æ¡†å‡ ä½•ä½“
            const wireframeGeometry = new THREE.WireframeGeometry(geometry);
            const wireframeMaterial = new THREE.LineBasicMaterial({
                color: 0xcccccc,
                linewidth: 1,
                transparent: true,
                opacity: 0.6
            });
            
            surfaceWireframe = new THREE.LineSegments(wireframeGeometry, wireframeMaterial);
            surfaceWireframe.visible = params.showWireframe;
            hyperboloidGroup.add(surfaceWireframe);
            
            console.log("åŒæ›²é¢è¡¨é¢å·²åˆ›å»ºï¼Œé¡¶ç‚¹æ•°:", geometry.attributes.position.count);
        }
        
        // åˆ›å»ºä¸¤æ—ç›´çº¹çº¿
        function createRuledLines() {
            // æ¸…é™¤ç°æœ‰çš„ç›´çº¹çº¿
            if (family1Group) family1Group.clear();
            if (family2Group) family2Group.clear();
            
            console.log("åˆ›å»ºç›´çº¹çº¿ï¼Œæ¯ç»„æ•°é‡:", params.lineCount);
            
            // åˆ›å»ºç¬¬ä¸€æ—ç›´çº¹çº¿ (çº¢è‰²)
            if (params.showFamily1) {
                const lineMaterial1 = new THREE.LineBasicMaterial({ 
                    color: 0xff6b6b,
                    linewidth: params.lineWidth,
                    transparent: true,
                    opacity: 0.9
                });
                
                // ç¬¬ä¸€æ—ç›´çº¹çº¿å‚æ•°æ–¹ç¨‹
                // x = a(cosÎ¸ + Î» sinÎ¸), y = b(sinÎ¸ - Î» cosÎ¸), z = cÎ»
                let linesCreated1 = 0;
                for (let i = 0; i < params.lineCount; i++) {
                    const theta = (i / params.lineCount) * Math.PI * 2;
                    
                    const points = [];
                    // Î»ä»è´Ÿåˆ°æ­£å˜åŒ–
                    for (let lambda = -params.lineLength/2; lambda <= params.lineLength/2; lambda += 0.3) {
                        const x = params.a * (Math.cos(theta) + lambda * Math.sin(theta));
                        const y = params.b * (Math.sin(theta) - lambda * Math.cos(theta));
                        const z = params.c * lambda;
                        
                        points.push(new THREE.Vector3(x, y, z));
                    }
                    
                    if (points.length > 1) {
                        const geometry = new THREE.BufferGeometry().setFromPoints(points);
                        const line = new THREE.Line(geometry, lineMaterial1);
                        family1Group.add(line);
                        linesCreated1++;
                    }
                }
                console.log("ç¬¬ä¸€æ—ç›´çº¹çº¿åˆ›å»ºæ•°é‡:", linesCreated1);
            }
            
            // åˆ›å»ºç¬¬äºŒæ—ç›´çº¹çº¿ (è“è‰²)
            if (params.showFamily2) {
                const lineMaterial2 = new THREE.LineBasicMaterial({ 
                    color: 0x4cc9f0,
                    linewidth: params.lineWidth,
                    transparent: true,
                    opacity: 0.9
                });
                
                // ç¬¬äºŒæ—ç›´çº¹çº¿å‚æ•°æ–¹ç¨‹
                // x = a(cosÎ¸ - Î¼ sinÎ¸), y = b(sinÎ¸ + Î¼ cosÎ¸), z = cÎ¼
                let linesCreated2 = 0;
                for (let i = 0; i < params.lineCount; i++) {
                    // ç¬¬äºŒæ—ä½¿ç”¨ç¨å¾®ä¸åŒçš„è§’åº¦åç§»ï¼Œä»¥æ˜¾ç¤ºäº¤å‰æ•ˆæœ
                    const theta = (i / params.lineCount) * Math.PI * 2 + Math.PI / params.lineCount;
                    
                    const points = [];
                    // Î¼ä»è´Ÿåˆ°æ­£å˜åŒ–
                    for (let mu = -params.lineLength/2; mu <= params.lineLength/2; mu += 0.3) {
                        const x = params.a * (Math.cos(theta) - mu * Math.sin(theta));
                        const y = params.b * (Math.sin(theta) + mu * Math.cos(theta));
                        const z = params.c * mu;
                        
                        points.push(new THREE.Vector3(x, y, z));
                    }
                    
                    if (points.length > 1) {
                        const geometry = new THREE.BufferGeometry().setFromPoints(points);
                        const line = new THREE.Line(geometry, lineMaterial2);
                        family2Group.add(line);
                        linesCreated2++;
                    }
                }
                console.log("ç¬¬äºŒæ—ç›´çº¹çº¿åˆ›å»ºæ•°é‡:", linesCreated2);
            }
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            console.log("è®¾ç½®äº‹ä»¶ç›‘å¬å™¨");
            
            // åŒæ›²é¢å‚æ•°æ»‘å—
            document.getElementById('a-param').addEventListener('input', function(e) {
                params.a = parseFloat(e.target.value);
                document.getElementById('a-value').textContent = params.a.toFixed(1);
                updateGeometry();
            });
            
            document.getElementById('b-param').addEventListener('input', function(e) {
                params.b = parseFloat(e.target.value);
                document.getElementById('b-value').textContent = params.b.toFixed(1);
                updateGeometry();
            });
            
            document.getElementById('c-param').addEventListener('input', function(e) {
                params.c = parseFloat(e.target.value);
                document.getElementById('c-value').textContent = params.c.toFixed(1);
                updateGeometry();
            });
            
            // ç›´çº¹çº¿æ§åˆ¶
            document.getElementById('line-count').addEventListener('input', function(e) {
                params.lineCount = parseInt(e.target.value);
                document.getElementById('line-count-value').textContent = params.lineCount;
                createRuledLines();
            });
            
            document.getElementById('line-length').addEventListener('input', function(e) {
                params.lineLength = parseFloat(e.target.value);
                document.getElementById('line-length-value').textContent = params.lineLength.toFixed(1);
                createRuledLines();
            });
            
            document.getElementById('line-width').addEventListener('input', function(e) {
                params.lineWidth = parseFloat(e.target.value);
                document.getElementById('line-width-value').textContent = params.lineWidth.toFixed(1);
                updateLineWidths();
            });
            
            // è¡¨é¢é€æ˜åº¦æ§åˆ¶
            document.getElementById('surface-opacity').addEventListener('input', function(e) {
                params.surfaceOpacity = parseFloat(e.target.value);
                document.getElementById('surface-opacity-value').textContent = params.surfaceOpacity.toFixed(2);
                if (surfaceMesh && surfaceMesh.material) {
                    surfaceMesh.material.opacity = params.surfaceOpacity;
                    surfaceMesh.material.needsUpdate = true;
                }
            });
            
            // æ˜¾ç¤ºæ§åˆ¶
            document.getElementById('show-family1').addEventListener('change', function(e) {
                params.showFamily1 = e.target.checked;
                if (family1Group) family1Group.visible = params.showFamily1;
                console.log("ç¬¬ä¸€æ—ç›´çº¹çº¿æ˜¾ç¤º:", params.showFamily1);
            });
            
            document.getElementById('show-family2').addEventListener('change', function(e) {
                params.showFamily2 = e.target.checked;
                if (family2Group) family2Group.visible = params.showFamily2;
                console.log("ç¬¬äºŒæ—ç›´çº¹çº¿æ˜¾ç¤º:", params.showFamily2);
            });
            
            document.getElementById('show-surface').addEventListener('change', function(e) {
                params.showSurface = e.target.checked;
                if (surfaceMesh) surfaceMesh.visible = params.showSurface;
                console.log("åŒæ›²é¢è¡¨é¢æ˜¾ç¤º:", params.showSurface);
            });
            
            document.getElementById('show-wireframe').addEventListener('change', function(e) {
                params.showWireframe = e.target.checked;
                if (surfaceWireframe) surfaceWireframe.visible = params.showWireframe;
                console.log("è¡¨é¢çº¿æ¡†æ˜¾ç¤º:", params.showWireframe);
            });
            
            document.getElementById('show-axes').addEventListener('change', function(e) {
                params.showAxes = e.target.checked;
                if (axesHelper) axesHelper.visible = params.showAxes;
                console.log("åæ ‡è½´æ˜¾ç¤º:", params.showAxes);
            });
            
            document.getElementById('auto-rotate').addEventListener('change', function(e) {
                params.autoRotate = e.target.checked;
                console.log("è‡ªåŠ¨æ—‹è½¬:", params.autoRotate);
            });
            
            // é¢„è®¾æŒ‰é’®
            document.getElementById('dense-btn').addEventListener('click', function() {
                params.lineCount = 60;
                params.lineLength = 6;
                params.a = 2.0;
                params.b = 1.8;
                params.c = 1.2;
                updateUI();
                updateGeometry();
                console.log("åˆ‡æ¢åˆ°å¯†é›†ç¼–ç»‡æ¨¡å¼");
            });
            
            document.getElementById('sparse-btn').addEventListener('click', function() {
                params.lineCount = 20;
                params.lineLength = 10;
                params.a = 2.0;
                params.b = 1.8;
                params.c = 1.2;
                updateUI();
                updateGeometry();
                console.log("åˆ‡æ¢åˆ°ç¨€ç–ç¼–ç»‡æ¨¡å¼");
            });
            
            document.getElementById('symmetric-btn').addEventListener('click', function() {
                params.a = 2.0;
                params.b = 2.0;
                params.c = 2.0;
                params.lineCount = 40;
                params.lineLength = 8;
                updateUI();
                updateGeometry();
                console.log("åˆ‡æ¢åˆ°å¯¹ç§°å½¢å¼");
            });
            
            document.getElementById('reset-btn').addEventListener('click', function() {
                resetParameters();
                console.log("é‡ç½®å‚æ•°");
            });
        }
        
        // æ›´æ–°å‡ ä½•ä½“
        function updateGeometry() {
            console.log("æ›´æ–°å‡ ä½•ä½“ï¼Œå‚æ•°:", {a: params.a, b: params.b, c: params.c});
            createHyperboloidSurface();
            createRuledLines();
        }
        
        // æ›´æ–°çº¿å®½
        function updateLineWidths() {
            // æ›´æ–°ç¬¬ä¸€æ—çº¿å®½
            if (family1Group) {
                family1Group.children.forEach(line => {
                    if (line.material) {
                        line.material.linewidth = params.lineWidth;
                        line.material.needsUpdate = true;
                    }
                });
            }
            
            // æ›´æ–°ç¬¬äºŒæ—çº¿å®½
            if (family2Group) {
                family2Group.children.forEach(line => {
                    if (line.material) {
                        line.material.linewidth = params.lineWidth;
                        line.material.needsUpdate = true;
                    }
                });
            }
        }
        
        // æ›´æ–°UIæ˜¾ç¤º
        function updateUI() {
            // æ›´æ–°æ»‘å—å’Œæ˜¾ç¤ºå€¼
            document.getElementById('a-param').value = params.a;
            document.getElementById('b-param').value = params.b;
            document.getElementById('c-param').value = params.c;
            document.getElementById('line-count').value = params.lineCount;
            document.getElementById('line-length').value = params.lineLength;
            document.getElementById('line-width').value = params.lineWidth;
            document.getElementById('surface-opacity').value = params.surfaceOpacity;
            
            document.getElementById('a-value').textContent = params.a.toFixed(1);
            document.getElementById('b-value').textContent = params.b.toFixed(1);
            document.getElementById('c-value').textContent = params.c.toFixed(1);
            document.getElementById('line-count-value').textContent = params.lineCount;
            document.getElementById('line-length-value').textContent = params.lineLength.toFixed(1);
            document.getElementById('line-width-value').textContent = params.lineWidth.toFixed(1);
            document.getElementById('surface-opacity-value').textContent = params.surfaceOpacity.toFixed(2);
        }
        
        // é‡ç½®å‚æ•°
        function resetParameters() {
            params = {
                a: 2.0,
                b: 1.8,
                c: 1.2,
                lineCount: 40,
                lineLength: 8.0,
                lineWidth: 2.5,
                surfaceOpacity: 0.3,
                showFamily1: true,
                showFamily2: true,
                showSurface: true,
                showWireframe: false,
                showAxes: true,
                autoRotate: true,
                rotationAngle: 0
            };
            
            updateUI();
            updateGeometry();
            
            // é‡ç½®å¤é€‰æ¡†
            document.getElementById('show-family1').checked = true;
            document.getElementById('show-family2').checked = true;
            document.getElementById('show-surface').checked = true;
            document.getElementById('show-wireframe').checked = false;
            document.getElementById('show-axes').checked = true;
            document.getElementById('auto-rotate').checked = true;
            
            // é‡ç½®ç»„å¯è§æ€§
            if (family1Group) family1Group.visible = true;
            if (family2Group) family2Group.visible = true;
            if (surfaceMesh) surfaceMesh.visible = true;
            if (surfaceWireframe) surfaceWireframe.visible = false;
            if (axesHelper) axesHelper.visible = true;
        }
        
        // çª—å£å¤§å°è°ƒæ•´
        function onWindowResize() {
            const canvas = document.getElementById('webgl-canvas');
            const width = canvas.parentElement.clientWidth;
            const height = canvas.parentElement.clientHeight;
            
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            animationId = requestAnimationFrame(animate);
            
            // è‡ªåŠ¨æ—‹è½¬æ•´ä¸ªåŒæ›²é¢ç»„ï¼ˆè¡¨é¢å’Œç›´çº¹çº¿ä¸€èµ·æ—‹è½¬ï¼‰
            if (params.autoRotate && hyperboloidGroup) {
                params.rotationAngle += 0.003; // å‡æ…¢æ—‹è½¬é€Ÿåº¦
                hyperboloidGroup.rotation.y = params.rotationAngle;
            }
            
            if (controls) controls.update();
            if (renderer && scene && camera) renderer.render(scene, camera);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...");
            try {
                init();
                console.log("åˆå§‹åŒ–æˆåŠŸï¼");
            } catch (error) {
                console.error("åˆå§‹åŒ–å¤±è´¥:", error);
                alert("åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯: " + error.message);
            }
        });
    </script>
</body>
</html>
