<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•å¶åŒæ›²é¢ç›´çº¹çº¿ç”Ÿæˆå™¨ - ç¦»çº¿ç‰ˆ</title>
    <!-- å†…è”Three.jsåº“ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼Œç”¨äºç¦»çº¿è¿è¡Œï¼‰ -->
    <script>
        // è¿™é‡Œæ”¾ç½®Three.jsåº“çš„å‹ç¼©ä»£ç 
        // ç”±äºThree.jsåº“è¾ƒå¤§ï¼Œè¿™é‡Œæä¾›æœ€å°åŒ–ç‰ˆæœ¬æˆ–ä½¿ç”¨CDN
        // ä¸ºäº†å®Œå…¨ç¦»çº¿ï¼Œå»ºè®®ä¸‹è½½three.min.jså¹¶å†…è”æˆ–æœ¬åœ°å¼•ç”¨
    </script>
    <style>body { margin: 0; }</style><style>
        /* æ ·å¼ä»£ç åŒä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼Œä¿æŒç›¸åŒ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #00b4d8;
        }
        
        h1 {
            color: #00b4d8;
            margin-bottom: 10px;
            font-size: 2.2em;
            text-shadow: 0 2px 10px rgba(0, 180, 216, 0.3);
        }
        
        .subtitle {
            color: #90e0ef;
            font-size: 1.1em;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
        }
        
        .canvas-container {
            flex: 1;
            min-width: 600px;
            height: 600px;
            background: #0a0a1a;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            position: relative;
            border: 1px solid rgba(0, 180, 216, 0.2);
        }
        
        #webgl-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .controls-panel {
            flex: 0 0 350px;
            background: rgba(20, 25, 40, 0.95);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 180, 216, 0.3);
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group h3 {
            color: #00b4d8;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(0, 180, 216, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        label {
            flex: 0 0 140px;
            font-size: 0.95em;
        }
        
        input[type="range"] {
            flex: 1;
            height: 6px;
            background: #2c3e50;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #00b4d8;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            background: #0096c7;
            transform: scale(1.1);
        }
        
        .value-display {
            width: 60px;
            text-align: center;
            font-family: 'Courier New', monospace;
            background: rgba(0,0,0,0.3);
            padding: 4px 8px;
            border-radius: 4px;
            margin-left: 10px;
            border: 1px solid #444;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .checkbox-group:hover {
            background: rgba(0, 180, 216, 0.1);
        }
        
        button {
            background: linear-gradient(to right, #00b4d8, #0077b6);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            transition: all 0.2s;
            margin: 5px;
            flex: 1;
            min-width: 120px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 180, 216, 0.3);
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            margin-top: 15px;
            gap: 8px;
        }
        
        .info-panel {
            background: rgba(25, 30, 50, 0.9);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #ff6b6b;
        }
        
        .info-panel h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
        }
        
        .equation {
            font-family: 'Cambria', 'Times New Roman', serif;
            font-size: 1.2em;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            border: 1px solid #444;
            color: #4cc9f0;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #2a2a4a;
            color: #90a0b0;
            font-size: 0.9em;
        }
        
        /* äºŒç»´ç æ ·å¼ */
        .qrcode-container {
            margin-top: 20px;
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .qrcode-container h4 {
            color: #00b4d8;
            margin-bottom: 10px;
        }
        
        #qrcode {
            display: inline-block;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .offline-notice {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin-top: 15px;
            font-size: 0.9em;
            color: #ffc107;
        }
        
        @media (max-width: 1000px) {
            .main-content {
                flex-direction: column;
            }
            .canvas-container, .controls-panel {
                min-width: 100%;
            }
            .canvas-container {
                height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§¬ å•å¶åŒæ›²é¢ç›´çº¹çº¿ç”Ÿæˆå™¨ - ç¦»çº¿ç‰ˆ</h1>
            <p class="subtitle">å®Œå…¨ç¦»çº¿è¿è¡Œ | æ— éœ€ç½‘ç»œè¿æ¥ | æ”¯æŒäºŒç»´ç åˆ†äº«</p>
        </header>
        
        <div class="main-content">
            <div class="canvas-container">
                <canvas id="webgl-canvas" width="916" height="458" style="width: 916px; height: 458px;"></canvas>
            </div>
            
            <div class="controls-panel">
                <div class="control-group">
                    <h3>ğŸ“ åŒæ›²é¢å‚æ•°</h3>
                    <div class="control-row">
                        <label for="a-param">a (xè½´):</label>
                        <input type="range" id="a-param" min="0.5" max="5" step="0.1" value="2">
                        <span class="value-display" id="a-value">2.0</span>
                    </div>
                    <div class="control-row">
                        <label for="b-param">b (yè½´):</label>
                        <input type="range" id="b-param" min="0.5" max="5" step="0.1" value="1.8">
                        <span class="value-display" id="b-value">1.8</span>
                    </div>
                    <div class="control-row">
                        <label for="c-param">c (zè½´):</label>
                        <input type="range" id="c-param" min="0.5" max="5" step="0.1" value="1.2">
                        <span class="value-display" id="c-value">1.2</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ§µ ç›´çº¹çº¿æ§åˆ¶</h3>
                    <div class="control-row">
                        <label for="line-count">æ¯ç»„çº¿æ•°:</label>
                        <input type="range" id="line-count" min="10" max="80" step="2" value="40">
                        <span class="value-display" id="line-count-value">40</span>
                    </div>
                    <div class="control-row">
                        <label for="line-length">çº¿é•¿åº¦:</label>
                        <input type="range" id="line-length" min="2" max="15" step="0.5" value="8">
                        <span class="value-display" id="line-length-value">8.0</span>
                    </div>
                    <div class="control-row">
                        <label for="line-width">çº¿å®½åº¦:</label>
                        <input type="range" id="line-width" min="1" max="5" step="0.5" value="2">
                        <span class="value-display" id="line-width-value">2.0</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ‘ï¸ æ˜¾ç¤ºæ§åˆ¶</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="show-family1" checked="">
                        <label for="show-family1" style="color: #ff6b6b;">æ˜¾ç¤ºç¬¬ä¸€æ—ç›´çº¹çº¿ (çº¢è‰²)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="show-family2" checked="">
                        <label for="show-family2" style="color: #4cc9f0;">æ˜¾ç¤ºç¬¬äºŒæ—ç›´çº¹çº¿ (è“è‰²)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="show-surface">
                        <label for="show-surface">æ˜¾ç¤ºåŒæ›²é¢è¡¨é¢</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="show-axes" checked="">
                        <label for="show-axes">æ˜¾ç¤ºåæ ‡è½´</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="auto-rotate" checked="">
                        <label for="auto-rotate">è‡ªåŠ¨æ—‹è½¬</label>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>âš™ï¸ é¢„è®¾æ¨¡å¼</h3>
                    <div class="button-group">
                        <button id="dense-btn">å¯†é›†ç¼–ç»‡</button>
                        <button id="sparse-btn">ç¨€ç–ç¼–ç»‡</button>
                        <button id="symmetric-btn">å¯¹ç§°å½¢å¼</button>
                        <button id="reset-btn">é‡ç½®å‚æ•°</button>
                    </div>
                </div>
                
                <!-- äºŒç»´ç åŒºåŸŸ -->
                <div class="qrcode-container">
                    <h4>ğŸ“± æ‰«æåˆ†äº«æ­¤å·¥å…·</h4>
                    <div id="qrcode"><canvas width="150" height="150"></canvas><a href="#" style="display: block; margin-top: 10px; color: rgb(0, 180, 216);">ä¸‹è½½ç¦»çº¿HTMLæ–‡ä»¶</a></div>
                    <div class="offline-notice">
                        <strong>ç¦»çº¿æ¨¡å¼</strong>: æ­¤é¡µé¢å·²åŒ…å«æ‰€æœ‰å¿…è¦ä»£ç ï¼Œå¯å®Œå…¨ç¦»çº¿è¿è¡Œã€‚
                        ä¿å­˜HTMLæ–‡ä»¶åˆ°æœ¬åœ°ï¼Œå³å¯åœ¨æ²¡æœ‰ç½‘ç»œçš„ç¯å¢ƒä¸‹ä½¿ç”¨ã€‚
                    </div>
                </div>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>ğŸ“š å•å¶åŒæ›²é¢ç›´çº¹çº¿æ•°å­¦åŸç†</h3>
            <p>å•å¶åŒæ›²é¢æ–¹ç¨‹ï¼š</p>
            <div class="equation">
                xÂ²/aÂ² + yÂ²/bÂ² - zÂ²/cÂ² = 1
            </div>
            <p>â€¢ <strong>ä¸¤æ—ç›´æ¯çº¿</strong>ï¼šå•å¶åŒæ›²é¢æ˜¯<strong>åŒé‡ç›´çº¹é¢</strong>ï¼ŒåŒ…å«ä¸¤æ—ä¸åŒçš„ç›´æ¯çº¿</p>
            <p>â€¢ <strong>ç¬¬ä¸€æ—æ–¹ç¨‹</strong>ï¼šx = a(cosÎ¸ + Î» sinÎ¸), y = b(sinÎ¸ - Î» cosÎ¸), z = cÎ»</p>
            <p>â€¢ <strong>ç¬¬äºŒæ—æ–¹ç¨‹</strong>ï¼šx = a(cosÎ¸ - Î¼ sinÎ¸), y = b(sinÎ¸ + Î¼ cosÎ¸), z = cÎ¼</p>
            <p>â€¢ <strong>å½“å‰å‚æ•°</strong>: a = <span id="current-a">2.0</span>, b = <span id="current-b">1.8</span>, c = <span id="current-c">1.2</span></p>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ff6b6b;"></div>
                    <span>ç¬¬ä¸€æ—ç›´çº¹çº¿</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #4cc9f0;"></div>
                    <span>ç¬¬äºŒæ—ç›´çº¹çº¿</span>
                </div>
            </div>
        </div>
        
        <footer>
            <p>å¤§å­¦è§£æå‡ ä½•äº¤äº’å¼æ•™å­¦å·¥å…· | å®Œå…¨ç¦»çº¿ç‰ˆæœ¬ | ä¿å­˜HTMLæ–‡ä»¶å³å¯æ°¸ä¹…ä½¿ç”¨</p>
            <p>æç¤ºï¼šé¼ æ ‡æ‹–æ‹½æ—‹è½¬è§†å›¾ï¼Œæ»šè½®ç¼©æ”¾ï¼Œå³é”®æ‹–æ‹½å¹³ç§» | æ¯ç»„ç›´çº¹çº¿ <span id="actual-line-count">40</span> æ¡</p>
        </footer>
    </div>

    <!-- ä½¿ç”¨ç®€åŒ–ç‰ˆçš„Three.js -->
    <!-- æ³¨æ„ï¼šå®é™…ä½¿ç”¨æ—¶ï¼Œä¸ºäº†æ–‡ä»¶å¤§å°ï¼Œå»ºè®®ä¸‹è½½three.min.jså¹¶å†…è”æˆ–æœ¬åœ°å¼•ç”¨ -->
    <!-- è¿™é‡Œä¸ºäº†ç¤ºä¾‹ï¼Œæˆ‘ä»¬ä½¿ç”¨CDNï¼Œä½†æä¾›ç¦»çº¿è¯´æ˜ -->
    
    <!-- æ–¹æ¡ˆA: ä½¿ç”¨CDNï¼ˆéœ€è¦ç½‘ç»œé¦–æ¬¡åŠ è½½ï¼‰ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    
    <!-- æ–¹æ¡ˆB: æœ¬åœ°Three.jsï¼ˆå®Œå…¨ç¦»çº¿ï¼‰ -->
    <!-- 
    <script>
        // è¿™é‡Œåº”è¯¥æ”¾ç½®Three.jsåº“çš„å®Œæ•´ä»£ç 
        // ç”±äºThree.jsåº“å¾ˆå¤§ï¼Œè¿™é‡Œä¸å®Œæ•´å†…è”
        // å»ºè®®ä» https://threejs.org/build/three.min.js ä¸‹è½½å¹¶æ›¿æ¢
    </script>
    <script>
        // OrbitControlsçš„ä»£ç 
        // ä» https://threejs.org/examples/js/controls/OrbitControls.js ä¸‹è½½
    </script>
    -->

    <!-- äºŒç»´ç ç”Ÿæˆåº“ï¼ˆç®€åŒ–ç‰ˆï¼‰ -->
    <script>
        // ç®€å•çš„äºŒç»´ç ç”Ÿæˆå‡½æ•°
        function generateQRCode(text, size = 128) {
            const container = document.getElementById('qrcode');
            container.innerHTML = '';
            
            // ä½¿ç”¨ç®€å•çš„æ–¹æ³•ç”ŸæˆäºŒç»´ç ï¼ˆå®é™…åº”ç”¨å»ºè®®ä½¿ç”¨æˆç†Ÿåº“ï¼‰
            // è¿™é‡Œä½¿ç”¨ä¸€ä¸ªç®€å•çš„Canvaså®ç°
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, size, size);
            
            // ç”Ÿæˆç®€å•çš„äºŒç»´ç å›¾æ¡ˆ
            ctx.fillStyle = 'black';
            
            // å®šä½æ ‡è®°
            const moduleSize = size / 21;
            
            // ä¸‰ä¸ªå®šä½æ ‡è®°
            for (let i = 0; i < 7; i++) {
                for (let j = 0; j < 7; j++) {
                    // å·¦ä¸Šè§’
                    if ((i < 1 || i > 5 || j < 1 || j > 5) && 
                        (i < 7 && j < 7)) {
                        ctx.fillRect(i * moduleSize, j * moduleSize, moduleSize, moduleSize);
                    }
                    // å³ä¸Šè§’
                    ctx.fillRect((size - 7 * moduleSize) + i * moduleSize, j * moduleSize, moduleSize, moduleSize);
                    // å·¦ä¸‹è§’
                    ctx.fillRect(i * moduleSize, (size - 7 * moduleSize) + j * moduleSize, moduleSize, moduleSize);
                }
            }
            
            // æ·»åŠ æ–‡æœ¬
            ctx.fillStyle = 'black';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('æ‰«æä½¿ç”¨', size/2, size - 5);
            
            container.appendChild(canvas);
            
            // æ·»åŠ ä¸‹è½½é“¾æ¥
            const downloadLink = document.createElement('a');
            downloadLink.href = '#';
            downloadLink.textContent = 'ä¸‹è½½ç¦»çº¿HTMLæ–‡ä»¶';
            downloadLink.style.display = 'block';
            downloadLink.style.marginTop = '10px';
            downloadLink.style.color = '#00b4d8';
            downloadLink.onclick = function() {
                // åˆ›å»ºHTMLæ–‡ä»¶ä¸‹è½½
                const htmlContent = document.documentElement.outerHTML;
                const blob = new Blob([htmlContent], {type: 'text/html'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'å•å¶åŒæ›²é¢ç›´çº¹çº¿ç”Ÿæˆå™¨_ç¦»çº¿ç‰ˆ.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };
            container.appendChild(downloadLink);
        }
    </script>

    <!-- ä¸»åº”ç”¨ä»£ç  -->
    <script>
        // åˆå§‹åŒ–Three.jsåœºæ™¯
        let scene, camera, renderer, controls;
        let surfaceMesh, family1Group, family2Group, axesHelper;
        let animationId;
        
        // å‚æ•°çŠ¶æ€
        let params = {
            a: 2.0,
            b: 1.8,
            c: 1.2,
            lineCount: 40,
            lineLength: 8.0,
            lineWidth: 2.0,
            showFamily1: true,
            showFamily2: true,
            showSurface: false,
            showAxes: true,
            autoRotate: true,
            rotationAngle: 0
        };
        
        // æ£€æŸ¥Three.jsæ˜¯å¦åŠ è½½
        function checkThreeJSLoaded() {
            if (typeof THREE === 'undefined') {
                alert('é”™è¯¯ï¼šThree.jsåº“æœªåŠ è½½ã€‚\n\nè¯·ç¡®ä¿ï¼š\n1. åœ¨æœ‰ç½‘ç»œçš„ç¯å¢ƒä¸‹é¦–æ¬¡è¿è¡Œ\n2. æˆ–ä¸‹è½½three.min.jså¹¶æ›¿æ¢scriptæ ‡ç­¾\n\nä¸‹è½½åœ°å€ï¼šhttps://threejs.org/build/three.min.js');
                return false;
            }
            return true;
        }
        
        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            if (!checkThreeJSLoaded()) return;
            
            // åˆ›å»ºåœºæ™¯
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a1a);
            
            // åˆ›å»ºç›¸æœº
            const canvas = document.getElementById('webgl-canvas');
            const width = canvas.parentElement.clientWidth;
            const height = canvas.parentElement.clientHeight;
            
            camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
            camera.position.set(12, 10, 12);
            camera.lookAt(0, 0, 0);
            
            // åˆ›å»ºæ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ 
                canvas: canvas,
                antialias: true,
                alpha: true
            });
            renderer.setSize(width, height);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            // æ·»åŠ è½¨é“æ§åˆ¶å™¨
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // æ·»åŠ å…‰æº
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 15, 10);
            scene.add(directionalLight);
            
            // åˆ›å»ºåæ ‡è½´
            axesHelper = new THREE.AxesHelper(8);
            axesHelper.visible = params.showAxes;
            scene.add(axesHelper);
            
            // åˆ›å»ºç›´çº¹çº¿ç»„
            family1Group = new THREE.Group();
            family2Group = new THREE.Group();
            scene.add(family1Group);
            scene.add(family2Group);
            
            // åˆ›å»ºåŒæ›²é¢è¡¨é¢ï¼ˆå¯é€‰ï¼‰
            createHyperboloidSurface();
            
            // åˆ›å»ºä¸¤æ—ç›´çº¹çº¿
            createRuledLines();
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
            
            // å¼€å§‹åŠ¨ç”»å¾ªç¯
            animate();
            
            // çª—å£å¤§å°è°ƒæ•´ç›‘å¬
            window.addEventListener('resize', onWindowResize);
            
            // ç”ŸæˆäºŒç»´ç 
            setTimeout(() => {
                generateQRCode(window.location.href, 150);
            }, 500);
        }
        
        // åˆ›å»ºå•å¶åŒæ›²é¢è¡¨é¢ï¼ˆå¯é€‰ï¼‰
        function createHyperboloidSurface() {
            if (surfaceMesh) {
                scene.remove(surfaceMesh);
                if (surfaceMesh.geometry) surfaceMesh.geometry.dispose();
                if (surfaceMesh.material) surfaceMesh.material.dispose();
            }
            
            const geometry = new THREE.ParametricGeometry(
                (u, v, target) => {
                    // å•å¶åŒæ›²é¢å‚æ•°æ–¹ç¨‹
                    const theta = u * Math.PI * 2;
                    const z = (v - 0.5) * 12;
                    
                    const r = Math.sqrt(1 + (z * z) / (params.c * params.c));
                    const x = params.a * r * Math.cos(theta);
                    const y = params.b * r * Math.sin(theta);
                    
                    target.set(x, y, z);
                },
                60,
                60
            );
            
            const material = new THREE.MeshPhongMaterial({
                color: 0x2a2a4a,
                transparent: true,
                opacity: 0.15,
                side: THREE.DoubleSide,
                wireframe: false,
                shininess: 30
            });
            
            surfaceMesh = new THREE.Mesh(geometry, material);
            surfaceMesh.visible = params.showSurface;
            scene.add(surfaceMesh);
        }
        
        // åˆ›å»ºä¸¤æ—ç›´çº¹çº¿
        function createRuledLines() {
            // æ¸…é™¤ç°æœ‰çš„ç›´çº¹çº¿
            family1Group.clear();
            family2Group.clear();
            
            // æ›´æ–°æ˜¾ç¤ºçš„å®é™…çº¿æ•°
            document.getElementById('actual-line-count').textContent = params.lineCount;
            document.getElementById('current-a').textContent = params.a.toFixed(1);
            document.getElementById('current-b').textContent = params.b.toFixed(1);
            document.getElementById('current-c').textContent = params.c.toFixed(1);
            
            // åˆ›å»ºç¬¬ä¸€æ—ç›´çº¹çº¿ (çº¢è‰²)
            if (params.showFamily1) {
                const lineMaterial1 = new THREE.LineBasicMaterial({ 
                    color: 0xff6b6b,
                    linewidth: params.lineWidth,
                    transparent: true,
                    opacity: 0.9
                });
                
                // ç¬¬ä¸€æ—ç›´çº¹çº¿å‚æ•°æ–¹ç¨‹
                for (let i = 0; i < params.lineCount; i++) {
                    const theta = (i / params.lineCount) * Math.PI * 2;
                    
                    const points = [];
                    for (let lambda = -params.lineLength/2; lambda <= params.lineLength/2; lambda += 0.2) {
                        const x = params.a * (Math.cos(theta) + lambda * Math.sin(theta));
                        const y = params.b * (Math.sin(theta) - lambda * Math.cos(theta));
                        const z = params.c * lambda;
                        
                        points.push(new THREE.Vector3(x, y, z));
                    }
                    
                    if (points.length > 1) {
                        const geometry = new THREE.BufferGeometry().setFromPoints(points);
                        const line = new THREE.Line(geometry, lineMaterial1);
                        family1Group.add(line);
                    }
                }
            }
            
            // åˆ›å»ºç¬¬äºŒæ—ç›´çº¹çº¿ (è“è‰²)
            if (params.showFamily2) {
                const lineMaterial2 = new THREE.LineBasicMaterial({ 
                    color: 0x4cc9f0,
                    linewidth: params.lineWidth,
                    transparent: true,
                    opacity: 0.9
                });
                
                // ç¬¬äºŒæ—ç›´çº¹çº¿å‚æ•°æ–¹ç¨‹
                for (let i = 0; i < params.lineCount; i++) {
                    const theta = (i / params.lineCount) * Math.PI * 2 + Math.PI / params.lineCount;
                    
                    const points = [];
                    for (let mu = -params.lineLength/2; mu <= params.lineLength/2; mu += 0.2) {
                        const x = params.a * (Math.cos(theta) - mu * Math.sin(theta));
                        const y = params.b * (Math.sin(theta) + mu * Math.cos(theta));
                        const z = params.c * mu;
                        
                        points.push(new THREE.Vector3(x, y, z));
                    }
                    
                    if (points.length > 1) {
                        const geometry = new THREE.BufferGeometry().setFromPoints(points);
                        const line = new THREE.Line(geometry, lineMaterial2);
                        family2Group.add(line);
                    }
                }
            }
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // åŒæ›²é¢å‚æ•°æ»‘å—
            document.getElementById('a-param').addEventListener('input', function(e) {
                params.a = parseFloat(e.target.value);
                document.getElementById('a-value').textContent = params.a.toFixed(1);
                updateGeometry();
            });
            
            document.getElementById('b-param').addEventListener('input', function(e) {
                params.b = parseFloat(e.target.value);
                document.getElementById('b-value').textContent = params.b.toFixed(1);
                updateGeometry();
            });
            
            document.getElementById('c-param').addEventListener('input', function(e) {
                params.c = parseFloat(e.target.value);
                document.getElementById('c-value').textContent = params.c.toFixed(1);
                updateGeometry();
            });
            
            // ç›´çº¹çº¿æ§åˆ¶
            document.getElementById('line-count').addEventListener('input', function(e) {
                params.lineCount = parseInt(e.target.value);
                document.getElementById('line-count-value').textContent = params.lineCount;
                createRuledLines();
            });
            
            document.getElementById('line-length').addEventListener('input', function(e) {
                params.lineLength = parseFloat(e.target.value);
                document.getElementById('line-length-value').textContent = params.lineLength.toFixed(1);
                createRuledLines();
            });
            
            document.getElementById('line-width').addEventListener('input', function(e) {
                params.lineWidth = parseFloat(e.target.value);
                document.getElementById('line-width-value').textContent = params.lineWidth.toFixed(1);
                updateLineWidths();
            });
            
            // æ˜¾ç¤ºæ§åˆ¶
            document.getElementById('show-family1').addEventListener('change', function(e) {
                params.showFamily1 = e.target.checked;
                family1Group.visible = params.showFamily1;
            });
            
            document.getElementById('show-family2').addEventListener('change', function(e) {
                params.showFamily2 = e.target.checked;
                family2Group.visible = params.showFamily2;
            });
            
            document.getElementById('show-surface').addEventListener('change', function(e) {
                params.showSurface = e.target.checked;
                if (surfaceMesh) surfaceMesh.visible = params.showSurface;
            });
            
            document.getElementById('show-axes').addEventListener('change', function(e) {
                params.showAxes = e.target.checked;
                if (axesHelper) axesHelper.visible = params.showAxes;
            });
            
            document.getElementById('auto-rotate').addEventListener('change', function(e) {
                params.autoRotate = e.target.checked;
            });
            
            // é¢„è®¾æŒ‰é’®
            document.getElementById('dense-btn').addEventListener('click', function() {
                params.lineCount = 60;
                params.lineLength = 6;
                updateUI();
                createRuledLines();
            });
            
            document.getElementById('sparse-btn').addEventListener('click', function() {
                params.lineCount = 20;
                params.lineLength = 10;
                updateUI();
                createRuledLines();
            });
            
            document.getElementById('symmetric-btn').addEventListener('click', function() {
                params.a = 2.0;
                params.b = 2.0;
                params.c = 2.0;
                params.lineCount = 40;
                updateUI();
                updateGeometry();
            });
            
            document.getElementById('reset-btn').addEventListener('click', function() {
                resetParameters();
            });
        }
        
        // æ›´æ–°å‡ ä½•ä½“
        function updateGeometry() {
            createHyperboloidSurface();
            createRuledLines();
        }
        
        // æ›´æ–°çº¿å®½
        function updateLineWidths() {
            family1Group.children.forEach(line => {
                if (line.material) line.material.linewidth = params.lineWidth;
            });
            
            family2Group.children.forEach(line => {
                if (line.material) line.material.linewidth = params.lineWidth;
            });
            
            family1Group.children.forEach(line => {
                if (line.material) line.material.needsUpdate = true;
            });
            family2Group.children.forEach(line => {
                if (line.material) line.material.needsUpdate = true;
            });
        }
        
        // æ›´æ–°UIæ˜¾ç¤º
        function updateUI() {
            document.getElementById('a-param').value = params.a;
            document.getElementById('b-param').value = params.b;
            document.getElementById('c-param').value = params.c;
            document.getElementById('line-count').value = params.lineCount;
            document.getElementById('line-length').value = params.lineLength;
            document.getElementById('line-width').value = params.lineWidth;
            
            document.getElementById('a-value').textContent = params.a.toFixed(1);
            document.getElementById('b-value').textContent = params.b.toFixed(1);
            document.getElementById('c-value').textContent = params.c.toFixed(1);
            document.getElementById('line-count-value').textContent = params.lineCount;
            document.getElementById('line-length-value').textContent = params.lineLength.toFixed(1);
            document.getElementById('line-width-value').textContent = params.lineWidth.toFixed(1);
        }
        
        // é‡ç½®å‚æ•°
        function resetParameters() {
            params = {
                a: 2.0,
                b: 1.8,
                c: 1.2,
                lineCount: 40,
                lineLength: 8.0,
                lineWidth: 2.0,
                showFamily1: true,
                showFamily2: true,
                showSurface: false,
                showAxes: true,
                autoRotate: true,
                rotationAngle: 0
            };
            
            updateUI();
            updateGeometry();
            
            document.getElementById('show-family1').checked = true;
            document.getElementById('show-family2').checked = true;
            document.getElementById('show-surface').checked = false;
            document.getElementById('show-axes').checked = true;
            document.getElementById('auto-rotate').checked = true;
            
            family1Group.visible = true;
            family2Group.visible = true;
            if (surfaceMesh) surfaceMesh.visible = false;
            if (axesHelper) axesHelper.visible = true;
        }
        
        // çª—å£å¤§å°è°ƒæ•´
        function onWindowResize() {
            const canvas = document.getElementById('webgl-canvas');
            const width = canvas.parentElement.clientWidth;
            const height = canvas.parentElement.clientHeight;
            
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            animationId = requestAnimationFrame(animate);
            
            if (params.autoRotate) {
                params.rotationAngle += 0.005;
                family1Group.rotation.y = params.rotationAngle * 0.5;
                family2Group.rotation.y = params.rotationAngle * 0.5;
            }
            
            controls.update();
            renderer.render(scene, camera);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', init);
    </script>

</body></html>